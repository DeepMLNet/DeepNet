<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Defining a Simple Model using Expressions
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Deep.Net machine learning framework"/>
    <meta name="author" content="Deep.Net developers"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="file://C:\local\surban\dev\Deep\DeepNet\docs\tools\../output/content/style.css" />
    <script type="text/javascript" src="file://C:\local\surban\dev\Deep\DeepNet\docs\tools\../output/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->

    <script type="text/javascript" async
              src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://github.com/DeepMLNet/DeepNet">github page</a></li>
        </ul>
        <h3 class="muted"><a href="file://C:\local\surban\dev\Deep\DeepNet\docs\tools\../output/index.html">Deep.Net</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Defining-a-Simple-Model-using-Expressions" class="anchor" href="#Defining-a-Simple-Model-using-Expressions">Defining a Simple Model using Expressions</a></h1>
<p>In this example we will show how to learn <a href="http://yann.lecun.com/exdb/mnist/">MNIST handwritten digit classification</a> using a two-layer feed-forward network.
As an introductory example, the model will be defined using basic mathematical expressions only to explain their use.
Deep.Net also allows to build model from components (for example a multi-layer perceptron) which is usually more understandable and more code efficient.
This technique will be explained in the <a href="components.html">Model Components</a> chapter.</p>
<p>You can run this example by executing <code>FsiAnyCPU.exe docs\content\model.fsx</code> after cloning the Deep.Net repository.
You can move your mouse over any symbol in the code samples to see the full signature.
A <a href="https://fsharpforfunandprofit.com/posts/function-signatures/">quick introduction to F# signatures</a> might be helpful.</p>
<h3><a name="Namespaces" class="anchor" href="#Namespaces">Namespaces</a></h3>
<p>The <code>ArrayNDNS</code> namespace houses the <a href="tensor.html">numeric tensor functionality</a>.
<code>SymTensor</code> houses the symbolic expression library.
<code>SymTensor.Compiler.Cuda</code> provides compilation of symbolic expressions to functions that are executed on a CUDA GPU.
The <code>Datasets</code> namespace provides dataset loading and handling functions.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">ArrayNDNS</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">SymTensor</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs2', 3)" onmouseover="showTip(event, 'fs2', 3)" class="i">SymTensor</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs3', 4)" onmouseover="showTip(event, 'fs3', 4)" class="i">Compiler</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 5)" onmouseover="showTip(event, 'fs4', 5)" class="i">Cuda</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="i">Datasets</span>
</code></pre></td>
</tr>
</table>
<h2><a name="Loading-MNIST" class="anchor" href="#Loading-MNIST">Loading MNIST</a></h2>
<p>Deep.Net provides the <code>Dataset</code> type for simple and efficient handling of datasets.
In this chapter we skip over the usage details and refer to the <a href="dataset.html">Dataset Handling</a> chapter for further information.</p>
<p>We use the Mnist module from the Datasets library to load the <a href="http://yann.lecun.com/exdb/mnist/">MNIST handwritten digits dataset</a> consisting of a training set of 60 000 sample and a test set of 10 000 sample.
Each sample consists of <span class="math">\(28 \times 28\)</span> pixels and an associated integer class label between 0 and 9.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs6', 7)" onmouseover="showTip(event, 'fs6', 7)" class="i">mnist</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs7', 8)" onmouseover="showTip(event, 'fs7', 8)" class="t">Mnist</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="f">load</span> (<span class="k">__SOURCE_DIRECTORY__</span> <span class="o">+</span> <span class="s">&quot;../../../Data/MNIST&quot;</span>) <span class="n">0.0</span>
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs9', 10)" onmouseover="showTip(event, 'fs9', 10)" class="t">TrnValTst</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs10', 11)" onmouseover="showTip(event, 'fs10', 11)" class="f">ToCuda</span>

<span onmouseout="hideTip(event, 'fs11', 12)" onmouseover="showTip(event, 'fs11', 12)" class="f">printfn</span> <span class="s">&quot;MNIST training set: images have shape </span><span class="pf">%A</span><span class="s"> and labels have shape </span><span class="pf">%A</span><span class="s">&quot;</span> 
    <span onmouseout="hideTip(event, 'fs6', 13)" onmouseover="showTip(event, 'fs6', 13)" class="i">mnist</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 14)" onmouseover="showTip(event, 'fs12', 14)" class="i">Trn</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 15)" onmouseover="showTip(event, 'fs13', 15)" class="i">All</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 16)" onmouseover="showTip(event, 'fs14', 16)" class="i">Img</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 17)" onmouseover="showTip(event, 'fs15', 17)" class="i">Shape</span> <span onmouseout="hideTip(event, 'fs6', 18)" onmouseover="showTip(event, 'fs6', 18)" class="i">mnist</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 19)" onmouseover="showTip(event, 'fs12', 19)" class="i">Trn</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 20)" onmouseover="showTip(event, 'fs13', 20)" class="i">All</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 21)" onmouseover="showTip(event, 'fs16', 21)" class="i">Lbl</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 22)" onmouseover="showTip(event, 'fs15', 22)" class="i">Shape</span>
<span onmouseout="hideTip(event, 'fs11', 23)" onmouseover="showTip(event, 'fs11', 23)" class="f">printfn</span> <span class="s">&quot;MNIST test set:     images have shape </span><span class="pf">%A</span><span class="s"> and labels have shape </span><span class="pf">%A</span><span class="s">&quot;</span> 
    <span onmouseout="hideTip(event, 'fs6', 24)" onmouseover="showTip(event, 'fs6', 24)" class="i">mnist</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 25)" onmouseover="showTip(event, 'fs17', 25)" class="i">Tst</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 26)" onmouseover="showTip(event, 'fs13', 26)" class="i">All</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 27)" onmouseover="showTip(event, 'fs14', 27)" class="i">Img</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 28)" onmouseover="showTip(event, 'fs15', 28)" class="i">Shape</span> <span onmouseout="hideTip(event, 'fs6', 29)" onmouseover="showTip(event, 'fs6', 29)" class="i">mnist</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 30)" onmouseover="showTip(event, 'fs17', 30)" class="i">Tst</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 31)" onmouseover="showTip(event, 'fs13', 31)" class="i">All</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 32)" onmouseover="showTip(event, 'fs16', 32)" class="i">Lbl</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 33)" onmouseover="showTip(event, 'fs15', 33)" class="i">Shape</span>
</code></pre></td>
</tr>
</table>
<p>This prints</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">MNIST</span> <span class="i">training</span> <span onmouseout="hideTip(event, 'fs18', 34)" onmouseover="showTip(event, 'fs18', 34)" class="i">set</span><span class="o">:</span> <span class="i">images</span> <span class="i">have</span> <span class="i">shape</span> [<span class="n">60000</span>; <span class="n">784</span>] <span class="k">and</span> <span class="i">labels</span> <span class="i">have</span> <span class="i">shape</span> [<span class="n">60000</span>; <span class="n">10</span>]
<span class="i">MNIST</span> <span class="i">test</span> <span onmouseout="hideTip(event, 'fs18', 35)" onmouseover="showTip(event, 'fs18', 35)" class="i">set</span><span class="o">:</span>     <span class="i">images</span> <span class="i">have</span> <span class="i">shape</span> [<span class="n">10000</span>; <span class="n">784</span>] <span class="k">and</span> <span class="i">labels</span> <span class="i">have</span> <span class="i">shape</span> [<span class="n">10000</span>; <span class="n">10</span>]
</code></pre></td>
</tr>
</table>
<p><code>Mnist.load</code> loads the MNIST dataset from the specified directory.
The second parameter specifies the ratio of training samples to put into the validation set.
Since we do not use a validation set in this sample, we set it to zero.
The <code>TrnValTst.toCuda</code> transfers the whole dataset to the GPU.</p>
<p><code>mnist.Trn</code> contains the training set and <code>mnist.Tst</code> contains the test set.
All training samples of a particular partition can be accessed using the <code>.All</code> property; e.g. <code>mnist.Trn.All</code> contains all training samples.</p>
<p>Hence <code>mnist.Trn.All.Img</code> is an array of shape <span class="math">\(60000 \times 784\)</span> that contains the flattened training images and <code>mnist.Trn.All.Lbl</code> is an array of shape <span class="math">\(60000 \times 10\)</span> containing the corresponding labels in one-hot encoding, i.e. <code>mnist.Trn.All.Lbl.[[n; c]] = 1</code> when the n-th training sample if of class (digit) c.</p>
<h2><a name="Defining-the-model" class="anchor" href="#Defining-the-model">Defining the model</a></h2>
<p>In Deep.Net a model is defined as a symbolic function of variables (input, target) and parameters (weights, biases, etc.).
In this example we construct our model using primitive operations; in a later chapter we will show how to combine predefined building blocks into a model.
To ensure that the model is valid, Deep.Net requires the specification of the shapes of all variables and parameters during the definition of the model.
For example <span class="math">\(a+b\)</span> is only valid if <span class="math">\(a\)</span> and <span class="math">\(b\)</span> are tensors of the same size (or can be broadcasted to the same size).
Similarly matrix multiplication <span class="math">\(a \cdot b\)</span> requires <span class="math">\(b\)</span> to have the as many rows as <span class="math">\(a\)</span> has columns.</p>
<p>The shape of a tensor can either be specified as a numeric value or, as usually done, using a symbolic value, e.g. the tensor <code>input</code> representing an input batch can be declared to be of size <span class="math">\(\mathrm{nInput} \times \mathrm{nBatch}\)</span> using the size symbols <code>nInput</code> and <code>nBatch</code>.
The model is checked as it is defined and errors are reported immediately in the offending source code line.
This way the long and painstaking process of identifying shape mismatches is avoided.</p>
<p>Each model definition in Deep.Net starts by instantiating <code>ModelBuilder</code>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 36)" onmouseover="showTip(event, 'fs19', 36)" class="i">mb</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs20', 37)" onmouseover="showTip(event, 'fs20', 37)" class="t">ModelBuilder</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs21', 38)" onmouseover="showTip(event, 'fs21', 38)" class="t">single</span><span class="o">&gt;</span> <span class="s">&quot;NeuralNetModel&quot;</span>
</code></pre></td>
</tr>
</table>
<p>The model builder keeps track of symbolic sizes and parameters used in the model.
It takes a generic parameter that specifies that data type of the parameters (weights, etc.) used in the model.
Since CUDA GPUs provide best performance with 32-bit floating point arithmetic the data type <code>single</code> should be used almost always.
The non-generic parameter specifies a human-readable name for the model and will become more important when defining sub-models (models that can be composed into a larger model).</p>
<h3><a name="Defining-size-symbols" class="anchor" href="#Defining-size-symbols">Defining size symbols</a></h3>
<p>Next, we define the size symbols for batch size, input vector size, target size and hidden layer size.
Although the input vector size and target size are known in advance, we opt to define them as size symbols anyway to keep the model more general and, if we make a mistake, receive more readable error messages.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 39)" onmouseover="showTip(event, 'fs22', 39)" class="i">nBatch</span>  <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 40)" onmouseover="showTip(event, 'fs19', 40)" class="i">mb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 41)" onmouseover="showTip(event, 'fs23', 41)" class="f">Size</span> <span class="s">&quot;nBatch&quot;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs24', 42)" onmouseover="showTip(event, 'fs24', 42)" class="i">nInput</span>  <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 43)" onmouseover="showTip(event, 'fs19', 43)" class="i">mb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 44)" onmouseover="showTip(event, 'fs23', 44)" class="f">Size</span> <span class="s">&quot;nInput&quot;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs25', 45)" onmouseover="showTip(event, 'fs25', 45)" class="i">nClass</span>  <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 46)" onmouseover="showTip(event, 'fs19', 46)" class="i">mb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 47)" onmouseover="showTip(event, 'fs23', 47)" class="f">Size</span> <span class="s">&quot;nClass&quot;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs26', 48)" onmouseover="showTip(event, 'fs26', 48)" class="i">nHidden</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 49)" onmouseover="showTip(event, 'fs19', 49)" class="i">mb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 50)" onmouseover="showTip(event, 'fs23', 50)" class="f">Size</span> <span class="s">&quot;nHidden&quot;</span>
</code></pre></td>
</tr>
</table>
<h3><a name="Defining-model-parameters" class="anchor" href="#Defining-model-parameters">Defining model parameters</a></h3>
<p>Our model consists of one hidden layer with a tanh activation function and an output layer with a softmax activation.
Thus our parameters consists of the weights and biases for the hidden layer and the weights for the output layer.
The <code>mb.Param</code> method of the model builder is used to define the parameters.
It takes a human readable name of the parameter, the shape and optionally and initialization function as parameters.
To keep things simple, we do not specify an initialization function at this point.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs27', 51)" onmouseover="showTip(event, 'fs27', 51)" class="v">hiddenWeights</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 52)" onmouseover="showTip(event, 'fs19', 52)" class="i">mb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 53)" onmouseover="showTip(event, 'fs28', 53)" class="f">Param</span> (<span class="s">&quot;hiddenWeights&quot;</span>, [<span onmouseout="hideTip(event, 'fs26', 54)" onmouseover="showTip(event, 'fs26', 54)" class="i">nHidden</span>; <span onmouseout="hideTip(event, 'fs24', 55)" onmouseover="showTip(event, 'fs24', 55)" class="i">nInput</span>])
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs29', 56)" onmouseover="showTip(event, 'fs29', 56)" class="v">hiddenBias</span>    <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 57)" onmouseover="showTip(event, 'fs19', 57)" class="i">mb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 58)" onmouseover="showTip(event, 'fs28', 58)" class="f">Param</span> (<span class="s">&quot;hiddenBias&quot;</span>,    [<span onmouseout="hideTip(event, 'fs26', 59)" onmouseover="showTip(event, 'fs26', 59)" class="i">nHidden</span>])
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs30', 60)" onmouseover="showTip(event, 'fs30', 60)" class="v">outputWeights</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 61)" onmouseover="showTip(event, 'fs19', 61)" class="i">mb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs28', 62)" onmouseover="showTip(event, 'fs28', 62)" class="f">Param</span> (<span class="s">&quot;outputWeights&quot;</span>, [<span onmouseout="hideTip(event, 'fs25', 63)" onmouseover="showTip(event, 'fs25', 63)" class="i">nClass</span>; <span onmouseout="hideTip(event, 'fs26', 64)" onmouseover="showTip(event, 'fs26', 64)" class="i">nHidden</span>])
</code></pre></td>
</tr>
</table>
<p>As the curious reader may have noted, <code>mb.Param</code> returns a <a href="https://msdn.microsoft.com/visualfsharpdocs/conceptual/reference-cells-%5bfsharp%5d">reference cell</a> to an expression.
The reason behind this is that for training (optimizing) of the model, it is beneficial to have all model parameters concatenated into a single continuous vector.
However, before such a vector can be constructed, all parameters and their shapes must be known.
Hence the model builder must delay its construction and returns a reference cell that will be filled when the <code>mb.Instantiate</code> method is called.</p>
<h3><a name="Defining-model-variables" class="anchor" href="#Defining-model-variables">Defining model variables</a></h3>
<p>We also need to define the input and (desired) target variables of the model.
While parameters and variables are both tensors, the difference between them is that parameters are values associated and stored with the model (i.e. not depending on a particular data sample) while variables represent data samples and are passed into the model.
The <code>mb.Var</code> method of the model builder takes a human-readable name for the variable and its shape as arguments.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 65)" onmouseover="showTip(event, 'fs31', 65)" class="i">input</span>  <span class="o">:</span> <span onmouseout="hideTip(event, 'fs32', 66)" onmouseover="showTip(event, 'fs32', 66)" class="t">ExprT</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs21', 67)" onmouseover="showTip(event, 'fs21', 67)" class="t">single</span><span class="o">&gt;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 68)" onmouseover="showTip(event, 'fs19', 68)" class="i">mb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs33', 69)" onmouseover="showTip(event, 'fs33', 69)" class="f">Var</span> <span class="s">&quot;Input&quot;</span>  [<span onmouseout="hideTip(event, 'fs22', 70)" onmouseover="showTip(event, 'fs22', 70)" class="i">nBatch</span>; <span onmouseout="hideTip(event, 'fs24', 71)" onmouseover="showTip(event, 'fs24', 71)" class="i">nInput</span>]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs34', 72)" onmouseover="showTip(event, 'fs34', 72)" class="i">target</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs32', 73)" onmouseover="showTip(event, 'fs32', 73)" class="t">ExprT</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs21', 74)" onmouseover="showTip(event, 'fs21', 74)" class="t">single</span><span class="o">&gt;</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 75)" onmouseover="showTip(event, 'fs19', 75)" class="i">mb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs33', 76)" onmouseover="showTip(event, 'fs33', 76)" class="f">Var</span> <span class="s">&quot;Target&quot;</span> [<span onmouseout="hideTip(event, 'fs22', 77)" onmouseover="showTip(event, 'fs22', 77)" class="i">nBatch</span>; <span onmouseout="hideTip(event, 'fs25', 78)" onmouseover="showTip(event, 'fs25', 78)" class="i">nClass</span>]
</code></pre></td>
</tr>
</table>
<h3><a name="Instantiating-the-model" class="anchor" href="#Instantiating-the-model">Instantiating the model</a></h3>
<p>Instantiating a model constructs a parameter vector that contains all parameters and allocates the corresponding storage space on the host or GPU.
Since storage space allocation requires numeric values for the shape of the parameters (<code>hiddenWeights</code>, <code>hiddenBias</code>, <code>outputWeights</code>) we need to provide values for the corresponding size symbols <code>nInput</code>, <code>nHidden</code> and <code>nClass</code>.</p>
<p>We use the <code>mb.SetSize</code> method of the model builder that takes a symbolic size and the corresponding numeric value.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs19', 79)" onmouseover="showTip(event, 'fs19', 79)" class="i">mb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 80)" onmouseover="showTip(event, 'fs35', 80)" class="f">SetSize</span> <span onmouseout="hideTip(event, 'fs24', 81)" onmouseover="showTip(event, 'fs24', 81)" class="i">nInput</span> <span onmouseout="hideTip(event, 'fs6', 82)" onmouseover="showTip(event, 'fs6', 82)" class="i">mnist</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 83)" onmouseover="showTip(event, 'fs12', 83)" class="i">Trn</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 84)" onmouseover="showTip(event, 'fs13', 84)" class="i">All</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 85)" onmouseover="showTip(event, 'fs14', 85)" class="i">Img</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 86)" onmouseover="showTip(event, 'fs15', 86)" class="i">Shape</span><span class="o">.</span>[<span class="n">1</span>]
<span onmouseout="hideTip(event, 'fs19', 87)" onmouseover="showTip(event, 'fs19', 87)" class="i">mb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 88)" onmouseover="showTip(event, 'fs35', 88)" class="f">SetSize</span> <span onmouseout="hideTip(event, 'fs25', 89)" onmouseover="showTip(event, 'fs25', 89)" class="i">nClass</span> <span onmouseout="hideTip(event, 'fs6', 90)" onmouseover="showTip(event, 'fs6', 90)" class="i">mnist</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 91)" onmouseover="showTip(event, 'fs12', 91)" class="i">Trn</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 92)" onmouseover="showTip(event, 'fs13', 92)" class="i">All</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 93)" onmouseover="showTip(event, 'fs16', 93)" class="i">Lbl</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 94)" onmouseover="showTip(event, 'fs15', 94)" class="i">Shape</span><span class="o">.</span>[<span class="n">1</span>]
<span onmouseout="hideTip(event, 'fs19', 95)" onmouseover="showTip(event, 'fs19', 95)" class="i">mb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 96)" onmouseover="showTip(event, 'fs35', 96)" class="f">SetSize</span> <span onmouseout="hideTip(event, 'fs26', 97)" onmouseover="showTip(event, 'fs26', 97)" class="i">nHidden</span> <span class="n">100</span>
</code></pre></td>
</tr>
</table>
<p>The number of inputs and classes are set from the corresponding shapes of the MNIST dataset and <code>nHidden</code> is set to 100.
Consequently we have a model with 784 input neurons, 100 hidden neurons and 10 output neurons.</p>
<p>Since all model sizes are defined and all parameters have been declared, we can now instantiate the model using the <code>mb.Instantiate</code> method of the model builder.
It takes a single argument specifying the location of the parameter vector.
This parameter can be <code>DevHost</code> for host (CPU) storage or <code>DevCuda</code> for GPU storage.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs36', 98)" onmouseover="showTip(event, 'fs36', 98)" class="i">mi</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 99)" onmouseover="showTip(event, 'fs19', 99)" class="i">mb</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 100)" onmouseover="showTip(event, 'fs37', 100)" class="f">Instantiate</span> <span onmouseout="hideTip(event, 'fs38', 101)" onmouseover="showTip(event, 'fs38', 101)" class="i">DevCuda</span>
</code></pre></td>
</tr>
</table>
<p>This causes the allocation of a parameter vector of appropriate size on the CUDA GPU and the reference cells for the model parameters <code>hiddenWeights</code>, <code>hiddenBias</code> and <code>outputWeights</code> are now filled with symbolic tensor slices of the parameter vector.</p>
<h3><a name="Defining-model-expressions" class="anchor" href="#Defining-model-expressions">Defining model expressions</a></h3>
<p>We can now define the expressions for the model.
We start with the hidden layer.
Its value is given by <span class="math">\(\mathbf{h} = W_h \mathbf{x} + \mathbf{b_h}\)</span> where <span class="math">\(W_h\)</span> are the hidden weights and <span class="math">\(\mathbf{b_h}\)</span> is the hidden bias.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs39', 102)" onmouseover="showTip(event, 'fs39', 102)" class="i">hiddenAct</span> <span class="o">=</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs27', 103)" onmouseover="showTip(event, 'fs27', 103)" class="v">hiddenWeights</span> <span class="o">.</span><span class="o">*</span> <span onmouseout="hideTip(event, 'fs31', 104)" onmouseover="showTip(event, 'fs31', 104)" class="i">input</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 105)" onmouseover="showTip(event, 'fs40', 105)" class="i">T</span> <span class="o">+</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs29', 106)" onmouseover="showTip(event, 'fs29', 106)" class="v">hiddenBias</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs41', 107)" onmouseover="showTip(event, 'fs41', 107)" class="i">hiddenVal</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs42', 108)" onmouseover="showTip(event, 'fs42', 108)" class="f">tanh</span> <span onmouseout="hideTip(event, 'fs39', 109)" onmouseover="showTip(event, 'fs39', 109)" class="i">hiddenAct</span>
</code></pre></td>
</tr>
</table>
<p>The <code>!</code> operator is used to dereference the reference cells for the parameters (see above).
The <code>.*</code> operator is defined as the dot product between two matrices or a matrix and a vector.
Since the <code>tanh</code> function is overloaded in Deep.Net, it can also be applied directly symbolic expressions.
This is also true for all standard arithmetic functions defined in F#, such as <code>sin</code>, <code>cos</code>, <code>log</code>, <code>ceil</code>.</p>
<p>Next, we define the expressions for the predictions of the model.
The output activations are given by <span class="math">\(\mathbf{g} = W_g \mathbf{h}\)</span> where <span class="math">\(W_g\)</span> are the output weights.
The class probabilities, i.e. the probabilities <span class="math">\(p(c=C)\)</span> that the sample is digit <span class="math">\(C\)</span>, are given by the <a href="https://en.wikipedia.org/wiki/Softmax_function">softmax function</a> <span class="math">\(p(c) = \exp(g_c) / \sum_{c'=0}^9 \exp(g_c')\)</span>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs43', 110)" onmouseover="showTip(event, 'fs43', 110)" class="i">outputAct</span> <span class="o">=</span> <span class="o">!</span><span onmouseout="hideTip(event, 'fs30', 111)" onmouseover="showTip(event, 'fs30', 111)" class="v">outputWeights</span> <span class="o">.</span><span class="o">*</span> <span onmouseout="hideTip(event, 'fs41', 112)" onmouseover="showTip(event, 'fs41', 112)" class="i">hiddenVal</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs44', 113)" onmouseover="showTip(event, 'fs44', 113)" class="i">classProb</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs45', 114)" onmouseover="showTip(event, 'fs45', 114)" class="f">exp</span> <span onmouseout="hideTip(event, 'fs43', 115)" onmouseover="showTip(event, 'fs43', 115)" class="i">outputAct</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs46', 116)" onmouseover="showTip(event, 'fs46', 116)" class="t">Expr</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 117)" onmouseover="showTip(event, 'fs47', 117)" class="f">sumKeepingAxis</span> <span class="n">0</span> (<span onmouseout="hideTip(event, 'fs45', 118)" onmouseover="showTip(event, 'fs45', 118)" class="f">exp</span> <span onmouseout="hideTip(event, 'fs43', 119)" onmouseover="showTip(event, 'fs43', 119)" class="i">outputAct</span>)
</code></pre></td>
</tr>
</table>
<p>Here we see the use of the <code>Expr.sumKeepingAxis</code> function.
It takes two arguments; the first argument specifies the axis to sum over and the second is the expression that should be summed.
The result has the same shape as the input but with the summation axis length set to one.
The <code>Expr.sumAxis</code> function sums over the specified axis returning a tensor with the summation axis removed.
The <code>Expr.sum</code> function sums over all axes returning a scalar tensor.</p>
<p>With the prediction expression fully defined, we still need to define a loss expression to train our models.
We use the standard <a href="https://en.wikipedia.org/wiki/Cross_entropy">cross entropy</a> loss in this example, <span class="math">\(L = - \sum_{c=0}^9 t_c \log p(c)\)</span> where <span class="math">\(t_c=1\)</span> if the sample is digit <span class="math">\(c\)</span> and <span class="math">\(0\)</span> otherwise (one-hot encoding).</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs48', 120)" onmouseover="showTip(event, 'fs48', 120)" class="i">smplLoss</span> <span class="o">=</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs46', 121)" onmouseover="showTip(event, 'fs46', 121)" class="t">Expr</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 122)" onmouseover="showTip(event, 'fs49', 122)" class="f">sumAxis</span> <span class="n">0</span> (<span onmouseout="hideTip(event, 'fs34', 123)" onmouseover="showTip(event, 'fs34', 123)" class="i">target</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 124)" onmouseover="showTip(event, 'fs40', 124)" class="i">T</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs50', 125)" onmouseover="showTip(event, 'fs50', 125)" class="f">log</span> <span onmouseout="hideTip(event, 'fs44', 126)" onmouseover="showTip(event, 'fs44', 126)" class="i">classProb</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs51', 127)" onmouseover="showTip(event, 'fs51', 127)" class="i">loss</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs46', 128)" onmouseover="showTip(event, 'fs46', 128)" class="t">Expr</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs52', 129)" onmouseover="showTip(event, 'fs52', 129)" class="f">mean</span> <span onmouseout="hideTip(event, 'fs48', 130)" onmouseover="showTip(event, 'fs48', 130)" class="i">smplLoss</span>
</code></pre></td>
</tr>
</table>
<p>To have a loss expression that is independent of the batch size, we take the mean of the loss over each batch.</p>
<h3><a name="Compiling-functions" class="anchor" href="#Compiling-functions">Compiling functions</a></h3>
<p>With the expressions fully defined, we can compile the loss expression into a function.
This is done using the <code>mi.Func</code> method of the instantiated model.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs53', 131)" onmouseover="showTip(event, 'fs53', 131)" class="f">lossFn</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs36', 132)" onmouseover="showTip(event, 'fs36', 132)" class="i">mi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 133)" onmouseover="showTip(event, 'fs54', 133)" class="f">Func</span> <span onmouseout="hideTip(event, 'fs51', 134)" onmouseover="showTip(event, 'fs51', 134)" class="i">loss</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs55', 135)" onmouseover="showTip(event, 'fs55', 135)" class="f">arg2</span> <span onmouseout="hideTip(event, 'fs31', 136)" onmouseover="showTip(event, 'fs31', 136)" class="i">input</span> <span onmouseout="hideTip(event, 'fs34', 137)" onmouseover="showTip(event, 'fs34', 137)" class="i">target</span>
</code></pre></td>
</tr>
</table>
<p><code>mi.Func</code> produces a function that expects a variable environment as its sole argument.
A variable environment (VarEnv) is an <a href="https://msdn.microsoft.com/en-us/visualfsharpdocs/conceptual/collections.map['key,'value]-class-[fsharp]">F# map</a> where keys are the symbolic variables (such as <code>input</code> or <code>target</code>) and values are the corresponding numeric tensors.
Since this makes calling the function a little awkward, we pipe the resulting function into the wrapper <code>arg2</code>.
<code>arg2</code> translates a function taking a VarEnv into a function taking two arguments that are used as values for the two symbolic variables passed as parameters to <code>arg2</code>.
Hence, in this example the resulting <code>lossFn</code> function takes two tensors as arguments, with the first argument becoming the value for the symbolic variable <code>input</code> and the second argument becoming the value for <code>target</code>.
There are wrappers <code>arg1</code>, <code>arg3</code>, <code>arg4</code>, ... for different number of arguments.
The return type of a compiled function is always a tensor.
If the result of the expression is a scalar (as in our case), the tensor will have rank zero.</p>
<h2><a name="Initializing-the-model-parameters" class="anchor" href="#Initializing-the-model-parameters">Initializing the model parameters</a></h2>
<p>We initialize the parameters model by calling <code>mi.InitPars</code>.
The only argument to that function is the seed to use for random initialization of the model's parameters.
<code>mi.InitPars</code> samples from an uniform distribution with support <span class="math">\([-0.01, 0.01]\)</span> to initialize all model parameters that had no initializer specified when calling <code>mb.Param</code>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs36', 138)" onmouseover="showTip(event, 'fs36', 138)" class="i">mi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs56', 139)" onmouseover="showTip(event, 'fs56', 139)" class="f">InitPars</span> <span class="n">123</span>
</code></pre></td>
</tr>
</table>
<p>We use a fixed seed of 123 to get reproducible results, but you can change it to a time-dependent value to get varying starting points.</p>
<h2><a name="Testing-the-model" class="anchor" href="#Testing-the-model">Testing the model</a></h2>
<p>We can now test our work so far by calculating the loss of the <em>untrained</em> model on the MNIST test set.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs57', 140)" onmouseover="showTip(event, 'fs57', 140)" class="i">tstLossUntrained</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs53', 141)" onmouseover="showTip(event, 'fs53', 141)" class="f">lossFn</span> <span onmouseout="hideTip(event, 'fs6', 142)" onmouseover="showTip(event, 'fs6', 142)" class="i">mnist</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 143)" onmouseover="showTip(event, 'fs17', 143)" class="i">Tst</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 144)" onmouseover="showTip(event, 'fs13', 144)" class="i">All</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 145)" onmouseover="showTip(event, 'fs14', 145)" class="i">Img</span> <span onmouseout="hideTip(event, 'fs6', 146)" onmouseover="showTip(event, 'fs6', 146)" class="i">mnist</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 147)" onmouseover="showTip(event, 'fs17', 147)" class="i">Tst</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 148)" onmouseover="showTip(event, 'fs13', 148)" class="i">All</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 149)" onmouseover="showTip(event, 'fs16', 149)" class="i">Lbl</span>
                       <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs58', 150)" onmouseover="showTip(event, 'fs58', 150)" class="t">ArrayND</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 151)" onmouseover="showTip(event, 'fs59', 151)" class="f">value</span>
<span onmouseout="hideTip(event, 'fs11', 152)" onmouseover="showTip(event, 'fs11', 152)" class="f">printfn</span> <span class="s">&quot;Test loss (untrained): </span><span class="pf">%.4f</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs57', 153)" onmouseover="showTip(event, 'fs57', 153)" class="i">tstLossUntrained</span>
</code></pre></td>
</tr>
</table>
<p>We call our compiled loss function as expected and pipe the result into the <code>Tensor.value</code> function to extract the float value from the zero-rank tensor.
This should print something similar to</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">Test</span> <span class="i">loss</span> (<span class="i">untrained</span>)<span class="o">:</span> <span class="n">2.3019</span>
</code></pre></td>
</tr>
</table>
<h2><a name="Training" class="anchor" href="#Training">Training</a></h2>
<p>An untrained model is a useless model.
To fix this we will use gradient descent to find parameter values where the loss is (locally) minimal.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs60', 154)" onmouseover="showTip(event, 'fs60', 154)" class="i">opt</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs61', 155)" onmouseover="showTip(event, 'fs61', 155)" class="i">Optimizers</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs62', 156)" onmouseover="showTip(event, 'fs62', 156)" class="t">GradientDescent</span> (<span onmouseout="hideTip(event, 'fs51', 157)" onmouseover="showTip(event, 'fs51', 157)" class="i">loss</span>, <span onmouseout="hideTip(event, 'fs36', 158)" onmouseover="showTip(event, 'fs36', 158)" class="i">mi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs63', 159)" onmouseover="showTip(event, 'fs63', 159)" class="i">ParameterVector</span>, <span onmouseout="hideTip(event, 'fs38', 160)" onmouseover="showTip(event, 'fs38', 160)" class="i">DevCuda</span>)
</code></pre></td>
</tr>
</table>
<p>We use the <code>GradientDescent</code> optimizer from the <code>Optimizers</code> library.
Each optimizer in Deep.Net takes three arguments: the expression to minimize, the variable with respect to the minimization should be performed and the device (DevHost or DevCuda).
The <code>mi.ParameterVector</code> property of the model instance provides a vector that is a concatenation of all model parameters defined via calls to <code>mb.Param</code>.
In our example <code>mi.ParameterVector</code> is a vector of length <span class="math">\(\mathrm{nHidden} \cdot \mathrm{nInput} + \mathrm{nHidden} + \mathrm{nClass} \cdot \mathrm{nHidden}\)</span> containing flattened views of the parameters <code>hiddenWeights</code>, <code>hiddenBias</code> and <code>outputWeights</code>.
Thus we have constructed a gradient descent optimizer that minimizes the loss with respect to our model's parameters.</p>
<p>What remains to be done, is to compile a function that performs an optimization step when called.
The expression that performs an optimization step when evaluated is provided in the <code>opt.Minimize</code> property of the optimizer instance.
We thus define the optimization function as follows.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs64', 161)" onmouseover="showTip(event, 'fs64', 161)" class="f">optFn</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs36', 162)" onmouseover="showTip(event, 'fs36', 162)" class="i">mi</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 163)" onmouseover="showTip(event, 'fs54', 163)" class="f">Func</span> <span onmouseout="hideTip(event, 'fs60', 164)" onmouseover="showTip(event, 'fs60', 164)" class="i">opt</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs65', 165)" onmouseover="showTip(event, 'fs65', 165)" class="i">Minimize</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs60', 166)" onmouseover="showTip(event, 'fs60', 166)" class="i">opt</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs66', 167)" onmouseover="showTip(event, 'fs66', 167)" class="f">Use</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs55', 168)" onmouseover="showTip(event, 'fs55', 168)" class="f">arg2</span> <span onmouseout="hideTip(event, 'fs31', 169)" onmouseover="showTip(event, 'fs31', 169)" class="i">input</span> <span onmouseout="hideTip(event, 'fs34', 170)" onmouseover="showTip(event, 'fs34', 170)" class="i">target</span>
</code></pre></td>
</tr>
</table>
<p>This definition is similar to <code>lossFn</code> with the addition of piping through <code>opt.Use</code>.
It makes the resulting function accept an additional parameter corresponding to the configuration of the optimizer and injects the necessary values into the VarEnv.
<code>opt.Use</code> must be used when compiling an optimization expression.
An optimization function returns an empty tensor (zero length).</p>
<p>Thus <code>optFn</code> is a function taking three parameters: the input images, the target labels and a record of type <code>GradientDescent.Cfg</code> that contains the optimizer configuration.</p>
<p>We still need to declare the optimizer configuration.
The gradient descent optimizer has a single configurable parameter: the learning rate.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs67', 171)" onmouseover="showTip(event, 'fs67', 171)" class="i">optCfg</span> <span class="o">=</span> { <span onmouseout="hideTip(event, 'fs61', 172)" onmouseover="showTip(event, 'fs61', 172)" class="i">Optimizers</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs62', 173)" onmouseover="showTip(event, 'fs62', 173)" class="t">GradientDescent</span><span class="o">.</span><span class="i">Step</span><span class="o">=</span><span class="n">1e-1f</span> }
</code></pre></td>
</tr>
</table>
<p>We use a learning rate of <span class="math">\(0.1\)</span>.
This high learning rate is feasible because we will calculate the gradient on the whole dataset (50 000 images) and thus it will be very stable.
If we did <a href="http://www.cs.toronto.edu/~tijmen/csc321/slides/lecture_slides_lec6.pdf">mini-batch training</a> instead, i.e. split the training set into small mini-batches and update the parameters after estimating the gradient on a mini-batch, we would have to use a smaller learning rate.</p>
<h3><a name="Training-loop" class="anchor" href="#Training-loop">Training loop</a></h3>
<p>We are now ready to train and evaluate our model using a simple training loop.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">for</span> <span onmouseout="hideTip(event, 'fs68', 174)" onmouseover="showTip(event, 'fs68', 174)" class="i">itr</span> <span class="o">=</span> <span class="n">0</span> <span class="k">to</span> <span class="n">1000</span> <span class="k">do</span>
    <span onmouseout="hideTip(event, 'fs64', 175)" onmouseover="showTip(event, 'fs64', 175)" class="f">optFn</span> <span onmouseout="hideTip(event, 'fs6', 176)" onmouseover="showTip(event, 'fs6', 176)" class="i">mnist</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 177)" onmouseover="showTip(event, 'fs12', 177)" class="i">Trn</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 178)" onmouseover="showTip(event, 'fs13', 178)" class="i">All</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 179)" onmouseover="showTip(event, 'fs14', 179)" class="i">Img</span> <span onmouseout="hideTip(event, 'fs6', 180)" onmouseover="showTip(event, 'fs6', 180)" class="i">mnist</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 181)" onmouseover="showTip(event, 'fs12', 181)" class="i">Trn</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 182)" onmouseover="showTip(event, 'fs13', 182)" class="i">All</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 183)" onmouseover="showTip(event, 'fs16', 183)" class="i">Lbl</span> <span onmouseout="hideTip(event, 'fs67', 184)" onmouseover="showTip(event, 'fs67', 184)" class="i">optCfg</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs69', 185)" onmouseover="showTip(event, 'fs69', 185)" class="f">ignore</span>
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs68', 186)" onmouseover="showTip(event, 'fs68', 186)" class="i">itr</span> <span class="o">%</span> <span class="n">50</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs70', 187)" onmouseover="showTip(event, 'fs70', 187)" class="i">l</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs53', 188)" onmouseover="showTip(event, 'fs53', 188)" class="f">lossFn</span> <span onmouseout="hideTip(event, 'fs6', 189)" onmouseover="showTip(event, 'fs6', 189)" class="i">mnist</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 190)" onmouseover="showTip(event, 'fs17', 190)" class="i">Tst</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 191)" onmouseover="showTip(event, 'fs13', 191)" class="i">All</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 192)" onmouseover="showTip(event, 'fs14', 192)" class="i">Img</span> <span onmouseout="hideTip(event, 'fs6', 193)" onmouseover="showTip(event, 'fs6', 193)" class="i">mnist</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 194)" onmouseover="showTip(event, 'fs17', 194)" class="i">Tst</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 195)" onmouseover="showTip(event, 'fs13', 195)" class="i">All</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 196)" onmouseover="showTip(event, 'fs16', 196)" class="i">Lbl</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs58', 197)" onmouseover="showTip(event, 'fs58', 197)" class="t">ArrayND</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 198)" onmouseover="showTip(event, 'fs59', 198)" class="f">value</span>
        <span onmouseout="hideTip(event, 'fs11', 199)" onmouseover="showTip(event, 'fs11', 199)" class="f">printfn</span> <span class="s">&quot;Test loss after </span><span class="pf">%5d</span><span class="s"> iterations: </span><span class="pf">%.4f</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs68', 200)" onmouseover="showTip(event, 'fs68', 200)" class="i">itr</span> <span onmouseout="hideTip(event, 'fs70', 201)" onmouseover="showTip(event, 'fs70', 201)" class="i">l</span>
</code></pre></td>
</tr>
</table>
<p>We train for 1000 iterations using the whole dataset (50 000 images) in each iteration.
The loss is evaluated every 50 iterations on the test set (10 000 images) and printed.</p>
<p>This should produce output similar to</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="i">Test</span> <span class="i">loss</span> <span class="i">after</span>     <span class="n">0</span> <span class="i">iterations</span><span class="o">:</span> <span class="n">2.3019</span>
<span class="i">Test</span> <span class="i">loss</span> <span class="i">after</span>    <span class="n">50</span> <span class="i">iterations</span><span class="o">:</span> <span class="n">2.0094</span>
<span class="i">Test</span> <span class="i">loss</span> <span class="i">after</span>   <span class="n">100</span> <span class="i">iterations</span><span class="o">:</span> <span class="n">1.0628</span>
<span class="o">..</span><span class="o">..</span>
<span class="i">Test</span> <span class="i">loss</span> <span class="i">after</span>  <span class="n">1000</span> <span class="i">iterations</span><span class="o">:</span> <span class="n">0.2713</span>
</code></pre></td>
</tr>
</table>
<p>Deep.Net also provides a generic training function with parameter and loss logging, automatic adjustment of the learning rate and automatic termination.
We will show its use in a later chapter.</p>
<h2><a name="Summary" class="anchor" href="#Summary">Summary</a></h2>
<p>In this introductory example we showed how to define symbolic sizes and build a two-layer neural network with a softmax output layer and cross-entropy loss using elementary mathematical operators.
Training was performed on the MNIST dataset using a simple training loop.</p>
<p>In the following sections, we will show how to assemble models from <a href="components.html">components</a> (such as neural layers and loss layers) and use a Deep.Net provided, configurable <a href="training.html">training function</a>.</p>

<div class="tip" id="fs1">namespace ArrayNDNS</div>
<div class="tip" id="fs2">namespace SymTensor</div>
<div class="tip" id="fs3">namespace SymTensor.Compiler</div>
<div class="tip" id="fs4">namespace SymTensor.Compiler.Cuda</div>
<div class="tip" id="fs5">namespace Datasets</div>
<div class="tip" id="fs6">val mnist : TrnValTst&lt;MnistT&gt;<br /><br />Full name: Model.mnist</div>
<div class="tip" id="fs7">module Mnist<br /><br />from Datasets</div>
<div class="tip" id="fs8">val load : directory:string -&gt; valRatio:float -&gt; TrnValTst&lt;MnistT&gt;<br /><br />Full name: Datasets.Mnist.load</div>
<div class="tip" id="fs9">type TrnValTst&lt;&#39;S&gt; =<br />&#160;&#160;{Trn: Dataset&lt;&#39;S&gt;;<br />&#160;&#160;&#160;Val: Dataset&lt;&#39;S&gt;;<br />&#160;&#160;&#160;Tst: Dataset&lt;&#39;S&gt;;}<br />&#160;&#160;member Save : filename:string -&gt; unit<br />&#160;&#160;member ToCuda : unit -&gt; TrnValTst&lt;&#39;S&gt;<br />&#160;&#160;member ToHost : unit -&gt; TrnValTst&lt;&#39;S&gt;<br />&#160;&#160;member private Pretty : string<br />&#160;&#160;static member Load : filename:string -&gt; TrnValTst&lt;&#39;S&gt;<br />&#160;&#160;static member Of : dataset:Dataset&lt;&#39;S&gt; * ?trnRatio:float * ?valRatio:float * ?tstRatio:float -&gt; TrnValTst&lt;&#39;S&gt;<br />&#160;&#160;static member ToCuda : this:TrnValTst&lt;&#39;S&gt; -&gt; TrnValTst&lt;&#39;S&gt;<br />&#160;&#160;static member ToHost : this:TrnValTst&lt;&#39;S&gt; -&gt; TrnValTst&lt;&#39;S&gt;<br /><br />Full name: Datasets.TrnValTst&lt;_&gt;</div>
<div class="tip" id="fs10">static member TrnValTst.ToCuda : this:TrnValTst&lt;&#39;S&gt; -&gt; TrnValTst&lt;&#39;S&gt;</div>
<div class="tip" id="fs11">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs12">TrnValTst.Trn: Dataset&lt;MnistT&gt;</div>
<div class="tip" id="fs13">property Dataset.All: MnistT</div>
<div class="tip" id="fs14">MnistT.Img: ArrayNDT&lt;single&gt;</div>
<div class="tip" id="fs15">property ArrayND.ArrayNDT.Shape: int list</div>
<div class="tip" id="fs16">MnistT.Lbl: ArrayNDT&lt;single&gt;</div>
<div class="tip" id="fs17">TrnValTst.Tst: Dataset&lt;MnistT&gt;</div>
<div class="tip" id="fs18">val set : elements:seq&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.set</div>
<div class="tip" id="fs19">val mb : ModelBuilder&lt;single&gt;<br /><br />Full name: Model.mb</div>
<div class="tip" id="fs20">Multiple items<br />type ModelBuilder&lt;&#39;T (requires equality)&gt; =<br />&#160;&#160;new : context:string -&gt; ModelBuilder&lt;&#39;T&gt;<br />&#160;&#160;new : context:string * isSubModule:bool -&gt; ModelBuilder&lt;&#39;T&gt;<br />&#160;&#160;member Fix : size:int -&gt; SizeSpecT<br />&#160;&#160;member Instantiate : device:IDevice * ?canDelay:bool -&gt; ModelInstance&lt;&#39;T&gt;<br />&#160;&#160;member Module : name:string -&gt; ModelBuilder&lt;&#39;T&gt;<br />&#160;&#160;member Param : name:string * shape:ShapeSpecT * ?initializer:Initializer&lt;&#39;T&gt; -&gt; ExprT&lt;&#39;T&gt; ref<br />&#160;&#160;member SetLoc : var:ExprT&lt;&#39;a1&gt; -&gt; loc:ArrayLocT -&gt; unit<br />&#160;&#160;member SetSize : size:SizeSpecT -&gt; value:int -&gt; unit<br />&#160;&#160;member Size : name:string -&gt; SizeSpecT<br />&#160;&#160;member UseTmplVal : var:ExprT&lt;&#39;a1&gt; -&gt; value:ArrayNDT&lt;&#39;a1&gt; -&gt; unit<br />&#160;&#160;...<br /><br />Full name: SymTensor.ModelContextTypes.ModelBuilder&lt;_&gt;<br /><br />--------------------<br />new : context:string -&gt; ModelBuilder&lt;&#39;T&gt;<br />new : context:string * isSubModule:bool -&gt; ModelBuilder&lt;&#39;T&gt;</div>
<div class="tip" id="fs21">Multiple items<br />val single : value:&#39;T -&gt; single (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.single<br /><br />--------------------<br />type single = System.Single<br /><br />Full name: Microsoft.FSharp.Core.single</div>
<div class="tip" id="fs22">val nBatch : SizeSpecT<br /><br />Full name: Model.nBatch</div>
<div class="tip" id="fs23">member ModelBuilder.Size : name:string -&gt; SizeSpecT</div>
<div class="tip" id="fs24">val nInput : SizeSpecT<br /><br />Full name: Model.nInput</div>
<div class="tip" id="fs25">val nClass : SizeSpecT<br /><br />Full name: Model.nClass</div>
<div class="tip" id="fs26">val nHidden : SizeSpecT<br /><br />Full name: Model.nHidden</div>
<div class="tip" id="fs27">val hiddenWeights : Expr.ExprT&lt;single&gt; ref<br /><br />Full name: Model.hiddenWeights</div>
<div class="tip" id="fs28">member ModelBuilder.Param : name:string * shape:ShapeSpecT * ?initializer:Initializer&lt;&#39;T&gt; -&gt; Expr.ExprT&lt;&#39;T&gt; ref</div>
<div class="tip" id="fs29">val hiddenBias : Expr.ExprT&lt;single&gt; ref<br /><br />Full name: Model.hiddenBias</div>
<div class="tip" id="fs30">val outputWeights : Expr.ExprT&lt;single&gt; ref<br /><br />Full name: Model.outputWeights</div>
<div class="tip" id="fs31">val input : ExprT&lt;single&gt;<br /><br />Full name: Model.input</div>
<div class="tip" id="fs32">type ExprT&lt;&#39;T&gt; = Expr.ExprT&lt;&#39;T&gt;<br /><br />Full name: SymTensor.ExprTypes2.ExprT&lt;_&gt;</div>
<div class="tip" id="fs33">member ModelBuilder.Var : name:string -&gt; shape:ShapeSpecT -&gt; Expr.ExprT&lt;&#39;a&gt;</div>
<div class="tip" id="fs34">val target : ExprT&lt;single&gt;<br /><br />Full name: Model.target</div>
<div class="tip" id="fs35">member ModelBuilder.SetSize : size:SizeSpecT -&gt; value:int -&gt; unit</div>
<div class="tip" id="fs36">val mi : ModelInstance&lt;single&gt;<br /><br />Full name: Model.mi</div>
<div class="tip" id="fs37">member ModelBuilder.Instantiate : device:IDevice * ?canDelay:bool -&gt; ModelInstance&lt;&#39;T&gt;</div>
<div class="tip" id="fs38">val DevCuda : IDevice<br /><br />Full name: SymTensor.Compiler.Cuda.CudaEvalTypes.DevCuda</div>
<div class="tip" id="fs39">val hiddenAct : Expr.ExprT&lt;single&gt;<br /><br />Full name: Model.hiddenAct</div>
<div class="tip" id="fs40">property Expr.ExprT.T: Expr.ExprT&lt;single&gt;</div>
<div class="tip" id="fs41">val hiddenVal : Expr.ExprT&lt;single&gt;<br /><br />Full name: Model.hiddenVal</div>
<div class="tip" id="fs42">val tanh : value:&#39;T -&gt; &#39;T (requires member Tanh)<br /><br />Full name: Microsoft.FSharp.Core.Operators.tanh</div>
<div class="tip" id="fs43">val outputAct : Expr.ExprT&lt;single&gt;<br /><br />Full name: Model.outputAct</div>
<div class="tip" id="fs44">val classProb : Expr.ExprT&lt;single&gt;<br /><br />Full name: Model.classProb</div>
<div class="tip" id="fs45">val exp : value:&#39;T -&gt; &#39;T (requires member Exp)<br /><br />Full name: Microsoft.FSharp.Core.Operators.exp</div>
<div class="tip" id="fs46">module Expr<br /><br />from SymTensor</div>
<div class="tip" id="fs47">val sumKeepingAxis : ax:int -&gt; a:Expr.ExprT&lt;&#39;a&gt; -&gt; Expr.ExprT&lt;&#39;a&gt;<br /><br />Full name: SymTensor.Expr.sumKeepingAxis</div>
<div class="tip" id="fs48">val smplLoss : Expr.ExprT&lt;single&gt;<br /><br />Full name: Model.smplLoss</div>
<div class="tip" id="fs49">val sumAxis : ax:int -&gt; a:Expr.ExprT&lt;&#39;a&gt; -&gt; Expr.ExprT&lt;&#39;a&gt;<br /><br />Full name: SymTensor.Expr.sumAxis</div>
<div class="tip" id="fs50">val log : value:&#39;T -&gt; &#39;T (requires member Log)<br /><br />Full name: Microsoft.FSharp.Core.Operators.log</div>
<div class="tip" id="fs51">val loss : Expr.ExprT&lt;single&gt;<br /><br />Full name: Model.loss</div>
<div class="tip" id="fs52">val mean : a:Expr.ExprT&lt;&#39;T&gt; -&gt; Expr.ExprT&lt;&#39;T&gt;<br /><br />Full name: SymTensor.Expr.mean</div>
<div class="tip" id="fs53">val lossFn : (ArrayNDT&lt;single&gt; -&gt; ArrayNDT&lt;single&gt; -&gt; ArrayNDT&lt;single&gt;)<br /><br />Full name: Model.lossFn</div>
<div class="tip" id="fs54">member ModelInstance.Func : expr0:ExprT&lt;&#39;T&gt; -&gt; (VarEnvT -&gt; ArrayNDT&lt;&#39;T&gt;)<br />member ModelInstance.Func : expr0:ExprT&lt;&#39;T&gt; * expr1:ExprT&lt;&#39;T&gt; -&gt; (VarEnvT -&gt; ArrayNDT&lt;&#39;T&gt; * ArrayNDT&lt;&#39;T&gt;)<br />member ModelInstance.Func : resultLoc:ArrayLocT * expr0:ExprT&lt;&#39;T&gt; -&gt; (VarEnvT -&gt; ArrayNDT&lt;&#39;T&gt;)<br />member ModelInstance.Func : expr0:ExprT&lt;&#39;T&gt; * expr1:ExprT&lt;&#39;T&gt; * expr2:ExprT&lt;&#39;T&gt; -&gt; (VarEnvT -&gt; ArrayNDT&lt;&#39;T&gt; * ArrayNDT&lt;&#39;T&gt; * ArrayNDT&lt;&#39;T&gt;)<br />member ModelInstance.Func : resultLoc:ArrayLocT * expr0:ExprT&lt;&#39;T&gt; * expr1:ExprT&lt;&#39;T&gt; -&gt; (VarEnvT -&gt; ArrayNDT&lt;&#39;T&gt; * ArrayNDT&lt;&#39;T&gt;)<br />member ModelInstance.Func : resultLoc:ArrayLocT * expr0:ExprT&lt;&#39;T&gt; * expr1:ExprT&lt;&#39;T&gt; * expr2:ExprT&lt;&#39;T&gt; -&gt; (VarEnvT -&gt; ArrayNDT&lt;&#39;T&gt; * ArrayNDT&lt;&#39;T&gt; * ArrayNDT&lt;&#39;T&gt;)</div>
<div class="tip" id="fs55">val arg2 : vs0:ExprT&lt;&#39;T0&gt; -&gt; vs1:ExprT&lt;&#39;T1&gt; -&gt; f:(VarEnvT -&gt; &#39;a) -&gt; val0:ArrayNDT&lt;&#39;T0&gt; -&gt; val1:ArrayNDT&lt;&#39;T1&gt; -&gt; &#39;a<br /><br />Full name: SymTensor.FuncTypes.arg2</div>
<div class="tip" id="fs56">member ModelInstance.InitPars : globalSeed:int -&gt; unit</div>
<div class="tip" id="fs57">val tstLossUntrained : single<br /><br />Full name: Model.tstLossUntrained</div>
<div class="tip" id="fs58">module ArrayND<br /><br />from ArrayNDNS</div>
<div class="tip" id="fs59">val value : a:ArrayND.ArrayNDT&lt;&#39;a&gt; -&gt; &#39;a<br /><br />Full name: ArrayNDNS.ArrayND.value</div>
<div class="tip" id="fs60">val opt : Optimizers.GradientDescent&lt;single&gt;<br /><br />Full name: Model.opt</div>
<div class="tip" id="fs61">namespace Optimizers</div>
<div class="tip" id="fs62">Multiple items<br />module GradientDescent<br /><br />from Optimizers<br /><br />--------------------<br />type GradientDescent&lt;&#39;T (requires equality)&gt; =<br />&#160;&#160;new : loss:ExprT&lt;&#39;T&gt; * pars:ExprT&lt;&#39;T&gt; * dev:IDevice -&gt; GradientDescent&lt;&#39;T&gt;<br />&#160;&#160;member PublishLoc : mb:ModelInstance&lt;&#39;a1&gt; -&gt; unit (requires equality)<br />&#160;&#160;member Use : f:(VarEnvT -&gt; &#39;a) -&gt; (VarEnvT -&gt; Cfg&lt;&#39;T&gt; -&gt; &#39;a)<br />&#160;&#160;member Minimize : ExprT&lt;&#39;T&gt;<br /><br />Full name: Optimizers.GradientDescent&lt;_&gt;<br /><br />--------------------<br />new : loss:ExprT&lt;&#39;T&gt; * pars:ExprT&lt;&#39;T&gt; * dev:IDevice -&gt; Optimizers.GradientDescent&lt;&#39;T&gt;</div>
<div class="tip" id="fs63">property ModelInstance.ParameterVector: ExprT&lt;single&gt;</div>
<div class="tip" id="fs64">val optFn : (ArrayNDT&lt;single&gt; -&gt; ArrayNDT&lt;single&gt; -&gt; Optimizers.GradientDescent.Cfg&lt;single&gt; -&gt; ArrayNDT&lt;single&gt;)<br /><br />Full name: Model.optFn</div>
<div class="tip" id="fs65">property Optimizers.GradientDescent.Minimize: Expr.ExprT&lt;single&gt;</div>
<div class="tip" id="fs66">member Optimizers.GradientDescent.Use : f:(VarEnvT -&gt; &#39;a) -&gt; (VarEnvT -&gt; Optimizers.GradientDescent.Cfg&lt;&#39;T&gt; -&gt; &#39;a)</div>
<div class="tip" id="fs67">val optCfg : Optimizers.GradientDescent.Cfg&lt;float32&gt;<br /><br />Full name: Model.optCfg</div>
<div class="tip" id="fs68">val itr : int</div>
<div class="tip" id="fs69">val ignore : value:&#39;T -&gt; unit<br /><br />Full name: Microsoft.FSharp.Core.Operators.ignore</div>
<div class="tip" id="fs70">val l : single</div>

        </div>
        <div class="span3">
          <!-- <img src="file://C:\local\surban\dev\Deep\DeepNet\docs\tools\../output/img/logo.png" alt="Deep.Net logo" style="width:150px;margin:10px" /> -->  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">Deep.Net</li>
            <li><a href="file://C:\local\surban\dev\Deep\DeepNet\docs\tools\../output/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/DeepNet">Get Library via NuGet</a></li>
            <li><a href="http://github.com/DeepMLNet/DeepNet">Source Code on GitHub</a></li>
            <li><a href="file://C:\local\surban\dev\Deep\DeepNet\docs\tools\../output/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Basics</li>
            <li><a href="file://C:\local\surban\dev\Deep\DeepNet\docs\tools\../output/tensor.html">Working with Tensors</a></li>
            <li><a href="file://C:\local\surban\dev\Deep\DeepNet\docs\tools\../output/model.html">Model Definition</a></li>
            <li><a href="file://C:\local\surban\dev\Deep\DeepNet\docs\tools\../output/components.html">Model Components</a></li>
            <li><a href="file://C:\local\surban\dev\Deep\DeepNet\docs\tools\../output/dataset.html">Dataset Handling</a></li>
            <li><a href="file://C:\local\surban\dev\Deep\DeepNet\docs\tools\../output/training.html">Training</a></li>

            <li class="nav-header">Advanced</li>
            <li><a href="file://C:\local\surban\dev\Deep\DeepNet\docs\tools\../output/diff.html">Automatic Differentiation</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="file://C:\local\surban\dev\Deep\DeepNet\docs\tools\../output/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/DeepMLNet/DeepNet"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
